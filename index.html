<html>
<body onclick="stop=true;">

<div id="test" class="compas">
    <div class="nota">
        1
    </div>

    <div class="nota" style="top: 100px; left:200px;">
        2
    </div>

    <div class="nota" style="top: 200px; left:400px;">
        3
    </div>

    <div class="nota" style="top: 300px; left:300px;">
        3
    </div>
</div>

<div id="test1" class="compas" style=" left:2000px;">
    <div class="nota">
        1
    </div>

    <div class="nota" style="top: 100px; left:100px;">
        2
    </div>

    <div class="nota" style="top: 200px; left:200px;">
        3
    </div>

    <div class="nota" style="top: 300px; left:400px;">
        3
    </div>
</div>




<div id="pulso" class="pulso" style="top: 200px; left:10px; position:absolute;">
    pulso
</div>

</body>

</html>
<style>
    .compas {
        position: absolute;
        top: 0px;
        left:0px;
    }
    .nota {
        background-color: red;
        -moz-border-radius: 20px;
        border-radius: 20px;
        border-color:red;
        color:white;
        padding-left:12px;
        padding-right:12px;
        padding-top:5px;
        padding-bottom:5px;
        font-size:1.5em;
        position:relative;
    }
    .pulso {
        background-color: black;
        -moz-border-radius: 20px;
        border-radius: 20px;
        border-color:black;
        color:white;
        padding-left:12px;
        padding-right:12px;
        padding-top:5px;
        padding-bottom:5px;
        font-size:1.5em;
        position: absolute;
    }

</style>

<script>
var stop = false;
var max_x = 1000;
var lastTime = -1;
var fps = 30;
var bpm = 60000 / 60;
var global_speed = 120/1000;
var bpm_progress = 0;
var animationLength = 10000; // Animation length in milliseconds

function formatDiv(id,progress) {
    var div = document.getElementById(id);
    if (div.x == undefined) div.x = parseInt(div.style.left.replace('px',''));
    if (div.y == undefined) div.y = 100;
    if (div.speed == undefined) div.speed = 1;
    //if (div.t == undefined) div.t = timestamp;
        
    //div.innerHTML= (1000/progress).toFixed(4) ;
    if (div.x > 0) {
        div.x -= (div.speed * global_speed * (progress==0?1:progress));
        div.style.left = div.x +'px';
    } 
    else {
        div.x=max_x;
    }
}

function doAnimation(timestamp) {
  var progress = 0;

  if (lastTime < 0) {
        lastTime = timestamp;
  } else {
        progress = timestamp - lastTime;
        bpm_progress+=progress;
        if (progress>=fps) {
            lastTime = timestamp;
      } else {
            requestAnimationFrame(doAnimation);
            return;  
      }
  }
  
formatDiv('test', progress);
formatDiv('test1', progress);

if (bpm_progress > bpm) {
    var div = document.getElementById('pulso');
    div.innerHTML="P";
    setTimeout(function () {
        var div = document.getElementById('pulso');
        div.innerHTML="";
    },100);
    bpm_progress=0;
}


  if (!stop) {
        requestAnimationFrame(doAnimation);
  }
}

// Start animation
window.requestAnimationFrame(doAnimation);
</script>
